!function(i){function t(i,t,o){this.options=i,this.marker=t,this.isOpen=i.isOpen||!1,this.opts=e,this.map=o}var e=null;(t.prototype=new BMap.Overlay).initialize=function(){var t=this.opts,e=t.menus,o=t.width,n=t.radius,r=2*n,a="uiPieMenu_"+((new Date).getTime()+Math.floor(1e3*Math.random())),s='<div id="'+a+'" class="ui-pie-menu">';e.length<1||(i.each(e,function(i,t){var e=t.href?t.href:"javascript:void(0);",o=t.target?t.target:"_self";s+='<a class="ui-pie-menu-item" href="'+e+'" title="'+t.title+'" target="'+o+'"><img src="'+t.icon+'" class="icon-img"/></a>'}),s+="</div>",this.dom=i(s).get(0),this.map.getPanes().markerPane.appendChild(this.dom),i("#"+a).css({width:r,height:r,position:"absolute",marginLeft:-n,marginTop:-n,"-webkit-border-radius":"50%","-moz-border-radius":"50%","-ms-border-radius":"50%","-o-border-radius":"50%",borderRadius:"50%",border:t.border}).find(".ui-pie-menu-item").css({width:o,height:o,lineHeight:o+"px",backgroundColor:t.bgColor,display:"block","-webkit-border-radius":"50%","-moz-border-radius":"50%","-ms-border-radius":"50%","-o-border-radius":"50%",borderRadius:"50%",textAlign:"center",position:"absolute",top:" 50%",left:"50%",marginLeft:-o/2,marginTop:-o/2,textDecoration:"none"}).find(".icon-img").css({border:"none","-webkit-border-radius":"50%","-moz-border-radius":"50%","-ms-border-radius":"50%","-o-border-radius":"50%",borderRadius:"50%"}),this.eventBind())},t.prototype.draw=function(){var t=this.opts,e=this.options,o=12,n=this.point={lng:e.lng,lat:e.lat},r=this.map.pointToOverlayPixel(n);t.icon&&t.icon.url&&(o=0),i(this.dom).css({left:r.x,top:r.y-o,opacity:0}),this.isOpen&&this.show()},t.prototype.show=function(){var t=this.opts,e=t.menus.length,o="semicircle"===t.type?180:360,n="semicircle"===t.type?e-1:e,r=Math.floor(o/n),a=t.radius,s=i(this.dom),p=s.find(".ui-pie-menu-item"),d=t.time;s.stop(!0).animate({opacity:1},d),i.each(p,function(t,e){var o=t*r*Math.PI/180,n=Math.floor(a+a*Math.cos(o)),s=Math.floor(a-a*Math.sin(o));i(this).stop(!0).animate({left:n,top:s,opacity:1},d)}),this.isOpen=!0},t.prototype.hide=function(){var t=this.opts,e=t.time,o=i(this.dom),n=t.width/2;o.stop(!0).animate({opacity:0},e).find(".ui-pie-menu-item").stop(!0).animate({left:"50%",top:"50%",marginLeft:-n,marginTop:-n,opacity:0},e),this.isOpen=!1},t.prototype.eventBind=function(){var t=this.opts,e=this,o=i(this.dom).find(".ui-pie-menu-item"),n=t.menus,r=t.close,a=(this.options,{});this.marker.onclick=function(){e.isOpen?e.hide():e.show()},i.each(n,function(t,n){n.href&&"javascript:void(0);"!=n.href||n.cb&&"function"==typeof n.cb&&o.eq(t).off("click").on("click",function(){a.id=n.id,a.point=e.point,n.cb(i(this),a),r&&e.hide()})})};var o=function(i){this.init(i)};o.prototype={init:function(t){var o={id:"",centerPoint:{lng:0,lat:0},level:15,type:"circle",Maptype:[],zoom:!1,close:!0,time:400,points:[],width:30,bgColor:"#fff",radius:80,border:"2px dashed red",menus:[]};e=i.extend(!0,{},o,t),this.renderMap()},renderMap:function(){var i=e.id,t=e.centerPoint,o=e.level;this.map=new BMap.Map(i),this.map.centerAndZoom(new BMap.Point(t.lng,t.lat),o),this.addControl()},addControl:function(){var i=this.map,t=e.Maptype,o=e.zoom;if(i.addControl(new BMap.NavigationControl),i.addControl(new BMap.ScaleControl),i.addControl(new BMap.OverviewMapControl),o&&i.enableScrollWheelZoom(!0),t.length>0){var n=this.getMapType(t);i.addControl(new BMap.MapTypeControl({mapTypes:n}))}this.createMarker()},getMapType:function(t){var e=[],o={"地图":BMAP_NORMAL_MAP,"卫星":BMAP_SATELLITE_MAP,"三维":BMAP_PERSPECTIVE_MAP};return i.each(t,function(i,t){t in o&&e.push(o[t])}),e},createMarker:function(){var t=this.map,o=this,n=e.points,r=e.icon;n.lenth<1||i.each(n,function(i,e){var n=new BMap.Point(e.lng,e.lat),a=new BMap.Marker(n);r&&r.url&&(a=new BMap.Marker(n,{icon:new BMap.Icon(r.url,new BMap.Size(r.width,r.height))})),t.addOverlay(a),o.renderPieMenu(e,a)})},renderPieMenu:function(i,e){var o=this.map,n=new t(i,e,o);o.addOverlay(n)}},window.MapPieMenu=o}(jQuery);